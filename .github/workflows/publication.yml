name: ğŸš€ PublicaciÃ³n y ActualizaciÃ³n AutomÃ¡tica

on:
  # Dispara el flujo de trabajo solo cuando se sube un nuevo tag (etiqueta) al repositorio.
  # El tag debe seguir el patrÃ³n vX.X.X (ej: v1.0.1).
  push:
    tags:
      - 'v*.*.*'

# Define las variables de entorno que serÃ¡n usadas en todos los trabajos (jobs)
env:
  # La clave GH_TOKEN se inyecta automÃ¡ticamente por GitHub Actions y se usa para autenticar
  # a electron-builder para que pueda subir los archivos a GitHub Releases.
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  
jobs:
  build_and_release:
    # Estrategia que ejecuta el trabajo en paralelo en diferentes sistemas operativos
    strategy:
      matrix:
        os: [macos-latest, ubuntu-latest, windows-latest]

    runs-on: ${{ matrix.os }}
    
    steps:
      - name: â¬‡ï¸ Checkout del CÃ³digo
        uses: actions/checkout@v4
        with:
          # Es necesario obtener el historial completo para que electron-builder pueda
          # determinar la versiÃ³n y la informaciÃ³n del Release.
          fetch-depth: 0

      - name: ğŸ› ï¸ Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          
      - name: ğŸ“¦ Instalar Dependencias
        run: npm install

      # -------------------------------------------------------------------
      # ğŸ”‘ Instalar dependencias para Linux (solo si estamos en Ubuntu)
      # -------------------------------------------------------------------
      - name: ğŸ§ Instalar Dependencias del Sistema (Linux)
        if: matrix.os == 'ubuntu-latest'
        # electron-builder necesita librerÃ­as del sistema para compilar AppImage, deb, etc.
        run: |
          sudo apt-get update
          sudo apt-get install --no-install-recommends -y icnsutils graphicsmagick xz-utils

      # -------------------------------------------------------------------
      # ğŸ—ï¸ Compilar y Publicar
      # -------------------------------------------------------------------
      - name: ğŸ“¤ Publicar Artefactos
        # electron-builder estÃ¡ configurado en package.json para publicar en GitHub.
        # El comando 'electron-builder' lee la versiÃ³n del tag y el GH_TOKEN.
        run: npm run dist
        
        # El token de GitHub se pasa automÃ¡ticamente al entorno (env: GH_TOKEN).
        # Este paso generarÃ¡ los instaladores (.exe, .dmg, .AppImage) y los archivos 
        # de metadatos (latest.yml, latest-linux.yml) y los subirÃ¡ al nuevo Release.